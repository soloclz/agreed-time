# 功能設計：智慧共同空檔搜尋 (Availability Match)

**日期:** 2025-12-28
**類型:** 核心功能 (Core Feature) / Pro 功能
**目標:** 解決雙向確認時間的繁瑣流程，實現「一鍵媒合」。

## 1. 核心概念 (Concept)
從「手動挑選」進化為「自動計算」。
透過讀取雙方（或多方）的行事曆狀態，自動計算交集 (Intersection)，直接產出「共同空檔 (Common Slots)」。

*   **公式:** `共同空檔 = (A.工作時間 ∩ B.工作時間) - (A.已佔用事件 ∪ B.已佔用事件)`

## 2. 使用流程 (User Flow)

### 情境：A (Organizer) 想要約 B (Participant)

1.  **發起 (A)**:
    *   A 已連結 Google Calendar。
    *   A 點擊「尋找共同時間 (Find Common Time)」，系統生成一個專屬的 **"Sync Link"**。
2.  **回應 (B)**:
    *   B 收到連結並點開。
    *   **情境 1 (B 是會員且已同步):** 系統自動比對，直接顯示 3-5 個建議的共同時段。B 點擊即成交。
    *   **情境 2 (B 未同步):** 系統顯示 A 的空檔，並強烈提示 B「登入並連結日曆以自動比對」。

## 3. 隱私設計 (Privacy)
採用 **"Blind Matching" (盲測)** 原則：
*   A 與 B 互相**看不到**對方的具體行程內容（如「看牙醫」、「約會」）。
*   系統僅在後端計算，前端只顯示「可預約 (Available)」或「忙碌 (Busy)」。

## 4. 採用策略：雙軌制 (Hybrid Adoption)

為了解決「用戶不習慣維護 AgreedTime 日曆」的問題，我們採取以下分層策略：

*   **Level 1: 輔助顯示 (唯讀參考)**
    *   Organizer 連結外部日曆後，在建立活動時，外部行程會以「背景浮水印」顯示，輔助他手動選時間。
*   **Level 2: 衝突檢查 (防呆)**
    *   Participant 投票時，系統自動標示他外部日曆上有衝突的時段（紅色），防止重複安排 (Double Booking)。
*   **Level 3: 自動媒合 (Pro)**
    *   針對重度使用者（如髮型師、顧問）。完全依賴外部日曆的數據來計算空檔，無需手動維護 AgreedTime。

## 5. 商業價值
*   **Viral Loop:** 為了使用「自動比對」的便利性，現有用戶會驅動對方註冊並授權日曆。
*   **Retention:** 一旦用戶授權了日曆，平台的黏著度將大幅提升。
